<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nebola Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;background:#121212;color:#eee;font-family:Segoe UI}
header{background:#1f1f1f;padding:15px;font-size:24px}
nav{padding:10px;background:#181818}
button{background:#0078d7;border:0;color:#fff;padding:8px 12px;border-radius:5px;cursor:pointer}
input,textarea{width:100%;background:#2a2a2a;color:white;border:0;padding:8px;margin-top:5px}
.card{background:#1e1e1e;padding:12px;margin-top:10px;border-radius:8px}
img{max-width:100%;border-radius:5px}
#publishSection{display:none}
</style>
</head>

<body>

<header>ðŸš€ Nebola Store</header>

<nav>
<button onclick="showStore()">Loja</button>
<button id="loginBtn" onclick="login()">Login GitHub</button>
<button id="publishBtn" onclick="showPublish()" style="display:none">Publicar</button>
</nav>

<div style="padding:15px">

<div id="storeSection">
<h2>Apps</h2>
<div id="store"></div>
</div>

<div id="publishSection">
<h2>Publicar App</h2>

<input id="name" placeholder="Nome">
<textarea id="desc" placeholder="DescriÃ§Ã£o"></textarea>
<input id="img" placeholder="Imagem (opcional)">
<input id="link" placeholder="Link Download">
<br><br>
<button onclick="publish()">Publicar</button>
</div>

</div>

<script>
const CLIENT_ID="Ov23liTjCF6XRzwSNrLJ";
const REPO="maguraa53-cell/nebula-db";
const FILE_PATH="apps.json";

let token=null;
let apps=[];

// ---------- LOGIN ----------
function login(){
location.href=`https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&scope=repo`;
}

if(location.search.includes("code=")){
fetch("https://corsproxy.io/?https://github.com/login/oauth/access_token",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
client_id:CLIENT_ID,
code:new URLSearchParams(location.search).get("code")
})
}).then(r=>r.text()).then(t=>{
token=new URLSearchParams(t).get("access_token");
document.getElementById("loginBtn").innerText="Logado";
document.getElementById("publishBtn").style.display="inline";
});
}

// ---------- LOAD APPS ----------
fetch(`https://raw.githubusercontent.com/${REPO}/main/apps.json`)
.then(r=>r.json())
.then(d=>{
apps=d;
render();
});

// ---------- RENDER ----------
function render(){
let s=document.getElementById("store");
s.innerHTML="";
apps.forEach(a=>{
s.innerHTML+=`
<div class="card">
<img src="${a.img}">
<h3>${a.name}</h3>
<p>${a.desc}</p>
<a href="${a.link}" target="_blank">
<button>Baixar</button>
</a>
</div>`;
});
}

// ---------- PUBLICAR ----------
function publish(){
if(!token){alert("FaÃ§a login");return;}

let app={
name:name.value,
desc:desc.value,
img:img.value || "https://via.placeholder.com/400x200",
link:link.value
};

apps.push(app);

fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`,{
headers:{Authorization:`token ${token}`}
})
.then(r=>r.json())
.then(file=>{
fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`,{
method:"PUT",
headers:{
Authorization:`token ${token}`,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"Novo app",
content:btoa(JSON.stringify(apps,null,2)),
sha:file.sha
})
}).then(()=>{
alert("Publicado!");
render();
showStore();
});
}

// ---------- UI ----------
function showStore(){
storeSection.style.display="block";
publishSection.style.display="none";
}
function showPublish(){
storeSection.style.display="none";
publishSection.style.display="block";
}
</script>

</body>
</html>
